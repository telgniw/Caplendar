(function($){var s=google.maps,l=function(p){return new s.LatLng(p[0],p[1]);},i=function(c){return'http://www.google.com/mapfiles/ms/micons/'+c+'.png';};$.fn.gmap=function(g){var a={css:{},zoom:7};return this.each(function(){if(g)$.extend(a,g);var t=this,p=a.position;$(t).css(a.css);if($.type(p)=='array')p=l(p);var u=new s.Map($(t)[0],{disableDoubleClickZoom:true,zoom:a.zoom,center:p,mapTypeId:s.MapTypeId.ROADMAP});$(t).data({map:u,markers:{}});s.event.addListener(u,'click',function(evt){var o=evt.latLng;var m=$.tmpl(a.template,{Location:{Lat:o.lat(),Lng:o.lng()}}).html();$(t).mark({key:'new',position:o,info:{name:'new event',text:m},autoOpen:true});});});};$.fn.mark=function(g){var a={color:'red',info:{name:'',text:''},autoOpen:false};return this.each(function(){if(g)$.extend(a,g);var u=$(this).data('map');if(u){var y=$(this).data('markers');var k=y[a.key],p=a.position;if(k)k.setMap(null);if($.type(p)=='array')p=l(p);k=new s.Marker({map:u,position:p,title:a.info.name,icon:i(a.color)});s.event.addListener(k,'click',a.prompt);y[a.key]=k;if(a.autoOpen)e.open(u,k);}});};$.fn.unmark=function(g){var a={};return this.each(function(){if(g)$.extend(a,g);var u=$(this).data('map');if(u){var y=$(this).data('markers');var k=y[a.key];if(k)k.setMap(null);}});};})(jQuery);